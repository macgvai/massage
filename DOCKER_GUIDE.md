# üê≥ Docker Guide - –ú–∞—Å—Å–∞–∂–Ω—ã–π —Å–∞–ª–æ–Ω

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.docker .env.production

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.production —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
nano .env.production
```

### 2. –ó–∞–ø—É—Å–∫
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
docker-compose --env-file .env.production up -d

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç
chmod +x docker-scripts.sh
./docker-scripts.sh start
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:3000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs -f
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ Dockerfile              # –û—Å–Ω–æ–≤–Ω–æ–π Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml      # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ .dockerignore           # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
‚îú‚îÄ‚îÄ nginx.conf              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ .env.docker             # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-scripts.sh       # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ DOCKER_GUIDE.md         # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞

### –°–ø–æ—Å–æ–± 1: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env.production –∏–∑ —à–∞–±–ª–æ–Ω–∞
cp .env.docker .env.production

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose --env-file .env.production up -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
docker-compose down
```

### –°–ø–æ—Å–æ–± 2: –û–±—ã—á–Ω—ã–π Docker
```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker build -t massage-app .

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  --name massage-app \
  -p 3000:3000 \
  --env-file .env.production \
  massage-app
```

### –°–ø–æ—Å–æ–± 3: –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```bash
# –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x docker-scripts.sh

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã
./docker-scripts.sh build    # –°–±–æ—Ä–∫–∞
./docker-scripts.sh start    # –ó–∞–ø—É—Å–∫
./docker-scripts.sh logs     # –õ–æ–≥–∏
./docker-scripts.sh stop     # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
```bash
# Telegram
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
TELEGRAM_CHAT_ID=–≤–∞—à_chat_id

# –ê–¥–º–∏–Ω–∫–∞
ADMIN_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
NEXT_PUBLIC_ADMIN_KEY=—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:
```bash
# –ù–µ—Å–∫–æ–ª—å–∫–æ Telegram —á–∞—Ç–æ–≤
TELEGRAM_CHAT_IDS_EXTRA=chat_id_2,chat_id_3

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Node.js
NODE_ENV=production
NEXT_TELEMETRY_DISABLED=1
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã:
- **3000** - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **80** - Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- **443** - HTTPS Nginx (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω SSL)

### Volumes (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):
- `./public/images:/app/public/images` - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `./config:/app/config` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–µ—Ç—å:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é Docker —Å–µ—Ç—å
- –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs massage-app
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É:
```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it massage-app sh

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
docker exec massage-app ps aux

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã
docker exec massage-app ls -la /app
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose down

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
docker-compose build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:
```bash
# API –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:3000/api/health

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
# –û—à–∏–±–∫–∏ Next.js
docker-compose logs massage-app | grep ERROR

# Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
docker-compose logs massage-app | grep "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —á–∞—Ç—ã"

# –ê–¥–º–∏–Ω–∫–∞
docker-compose logs massage-app | grep "admin"
```

## üåê Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ó–∞–ø—É—Å–∫ —Å Nginx:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å Nginx
docker-compose --profile with-nginx up -d

# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose up -d
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è SSL
mkdir ssl

# –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
cp your-cert.pem ssl/cert.pem
cp your-key.pem ssl/key.pem

# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS —Å–µ–∫—Ü–∏—é –≤ nginx.conf
```

## üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π

### –ù–∞ VPS/—Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone your-repo
cd massage-salon

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
cp .env.docker .env.production
nano .env.production

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose --env-file .env.production up -d

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable docker
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
```bash
# –ü–æ–ª—É—á–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose down
docker-compose build
docker-compose --env-file .env.production up -d
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ root** - –æ–±—Ä–∞–∑ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø–æ—Ä—Ç—ã** - –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ
3. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é

### –§–∞–π—Ä–≤–æ–ª:
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `node:18-alpine` (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)
- Multi-stage —Å–±–æ—Ä–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
- `.dockerignore` –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- Standalone —Ä–µ–∂–∏–º Next.js –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ü–∞–º—è—Ç—å:
```bash
# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run --memory=512m massage-app

# –í docker-compose.yml
deploy:
  resources:
    limits:
      memory: 512M
```

## ‚ùì –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec massage-app env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã
netstat -tulpn | grep 3000
```

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
docker exec massage-app ls -la /app/public/images

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ volume
docker volume ls
docker volume inspect massage_images_data

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏
docker-compose logs massage-app | grep "Upload directory"

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ bind mount:
# –í docker-compose.yml –∑–∞–º–µ–Ω–∏—Ç–µ:
# volumes:
#   - images_data:/app/public/images
# –Ω–∞:
# volumes:
#   - ./public/images:/app/public/images
```

### –ê–¥–º–∏–Ω–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
docker exec massage-app env | grep ADMIN

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã
docker exec massage-app ls -la /app/config
```

### Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ chat_id
docker exec massage-app env | grep TELEGRAM

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
docker-compose logs | grep "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —á–∞—Ç—ã"
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
docker system prune -a

# –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤
docker images

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
docker system df

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker inspect massage-app
```

### –ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ë—ç–∫–∞–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
tar -czf images-backup.tar.gz public/images/

# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
tar -czf config-backup.tar.gz config/
```